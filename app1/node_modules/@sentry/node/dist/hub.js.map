{"version":3,"file":"hub.js","sourceRoot":"","sources":["../src/hub.ts"],"names":[],"mappings":";;AAAA,mCAA+E;AAC/E,+BAAiC;AAYjC;;;;;;GAMG;AACH,SAAgB,aAAa;IAC3B,IAAM,SAAS,GAAG,mBAAiB,EAAE,CAAC;IACtC,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE;QAClB,OAAO,SAAS,CAAC;KAClB;IAED,IAAI,OAAO,GAAG,MAAM,CAAC,MAAM,CAAC,UAAU,CAAC;IACvC,IAAI,CAAC,OAAO,EAAE;QACZ,MAAM,CAAC,MAAM,CAAC,UAAU,GAAG,OAAO,GAAG,EAAE,CAAC;KACzC;IAED,IAAI,CAAC,OAAO,CAAC,GAAG,EAAE;QAChB,IAAM,KAAG,GAAG,SAAS,CAAC,WAAW,EAAE,CAAC;QACpC,OAAO,CAAC,GAAG,GAAG,KAAG,CAAC,CAAC,CAAC,IAAI,SAAG,CAAC,KAAG,CAAC,MAAM,EAAE,KAAG,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,SAAG,EAAE,CAAC;KAChE;IAED,OAAO,OAAO,CAAC,GAAG,CAAC;AACrB,CAAC;AAjBD,sCAiBC","sourcesContent":["import { Carrier, getCurrentHub as getCurrentHubBase, Hub } from '@sentry/hub';\nimport * as domain from 'domain';\n\ndeclare module 'domain' {\n  export let active: Domain;\n  /**\n   * Extension for domain interface\n   */\n  export interface Domain {\n    __SENTRY__?: Carrier;\n  }\n}\n\n/**\n * Returns the latest global hub instance.\n *\n * If a hub is already registered in the global carrier but this module\n * contains a more recent version, it replaces the registered version.\n * Otherwise, the currently registered hub will be returned.\n */\nexport function getCurrentHub(): Hub {\n  const globalHub = getCurrentHubBase();\n  if (!domain.active) {\n    return globalHub;\n  }\n\n  let carrier = domain.active.__SENTRY__;\n  if (!carrier) {\n    domain.active.__SENTRY__ = carrier = {};\n  }\n\n  if (!carrier.hub) {\n    const top = globalHub.getStackTop();\n    carrier.hub = top ? new Hub(top.client, top.scope) : new Hub();\n  }\n\n  return carrier.hub;\n}\n"]}