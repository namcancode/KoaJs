{"version":3,"file":"modules.js","sourceRoot":"","sources":["../../../src/integrations/pluggable/modules.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,6BAA+B;AAE/B,iCAA0C;AAE1C,IAAI,WAAsC,CAAC;AAE3C,+CAA+C;AAC/C;IAAA;QACE;;WAEG;QACI,SAAI,GAAW,SAAS,CAAC;IAsBlC,CAAC;IApBC;;OAEG;IACI,yBAAO,GAAd,UAAe,CAAmB;QAAlC,iBAOC;QAPc,kBAAA,EAAA,MAAmB;QAChC,mBAAa,EAAE,CAAC,cAAc,CAAC,UAAC,KAAY;YAC1C,KAAK,CAAC,iBAAiB,CAAC,UAAM,KAAK;;oBAAI,sBAAA,cAClC,KAAK,IACR,OAAO,EAAE,IAAI,CAAC,UAAU,EAAE,IAC1B,EAAA;;iBAAA,CAAC,CAAC;QACN,CAAC,CAAC,CAAC;IACL,CAAC;IAED,kGAAkG;IAC1F,4BAAU,GAAlB;QACE,IAAI,CAAC,WAAW,EAAE;YAChB,yCAAyC;YACzC,WAAW,GAAG,KAAK,EAAE,CAAC;SACvB;QACD,OAAO,WAAW,CAAC;IACrB,CAAC;IACH,cAAC;AAAD,CAAC,AA1BD,IA0BC;AA1BY,0BAAO","sourcesContent":["import { Scope } from '@sentry/hub';\nimport { Integration } from '@sentry/types';\nimport * as lsmod from 'lsmod';\nimport { NodeOptions } from '../../backend';\nimport { getCurrentHub } from '../../hub';\n\nlet moduleCache: { [key: string]: string };\n\n/** Add node modules / packages to the event */\nexport class Modules implements Integration {\n  /**\n   * @inheritDoc\n   */\n  public name: string = 'Modules';\n\n  /**\n   * @inheritDoc\n   */\n  public install(_: NodeOptions = {}): void {\n    getCurrentHub().configureScope((scope: Scope) => {\n      scope.addEventProcessor(async event => ({\n        ...event,\n        modules: this.getModules(),\n      }));\n    });\n  }\n\n  /** Fetches the list of modules and the versions loaded by the entry file for your node.js app. */\n  private getModules(): { [key: string]: string } {\n    if (!moduleCache) {\n      // tslint:disable-next-line:no-unsafe-any\n      moduleCache = lsmod();\n    }\n    return moduleCache;\n  }\n}\n"]}